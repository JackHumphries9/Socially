<!DOCTYPE html>
<html class="border-radius: 5px">
  <head>
    <meta charset="UTF-8">
    <title>Socially</title>

    <link rel="stylesheet" href="style.css" />
    <link href="assets/css/fontawesome/all.css" rel="stylesheet"> <!--load all fa styles -->
    <link rel="stylesheet" href="assets/css/notyf.min.css">
  </head>
  <body>

    <header id="titlebar">
      <div id="drag-region">
        <div id="window-title">
          <span><script>document.write(document.title)</script></span>
        </div>

        <div id="window-controls">
          <div class="button" id="min-button">
            <img class="icon" srcset="assets/icons/min-w-10.png 1x, assets/icons/min-w-12.png 1.25x, assets/icons/min-w-15.png 1.5x, assets/icons/min-w-15.png 1.75x, assets/icons/min-w-20.png 2x, assets/icons/min-w-20.png 2.25x, assets/icons/min-w-24.png 2.5x, assets/icons/min-w-30.png 3x, assets/icons/min-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="max-button">
            <img class="icon" srcset="assets/icons/max-w-10.png 1x, assets/icons/max-w-12.png 1.25x, assets/icons/max-w-15.png 1.5x, assets/icons/max-w-15.png 1.75x, assets/icons/max-w-20.png 2x, assets/icons/max-w-20.png 2.25x, assets/icons/max-w-24.png 2.5x, assets/icons/max-w-30.png 3x, assets/icons/max-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="restore-button">
            <img class="icon" srcset="assets/icons/restore-w-10.png 1x, assets/icons/restore-w-12.png 1.25x, assets/icons/restore-w-15.png 1.5x, assets/icons/restore-w-15.png 1.75x, assets/icons/restore-w-20.png 2x, assets/icons/restore-w-20.png 2.25x, assets/icons/restore-w-24.png 2.5x, assets/icons/restore-w-30.png 3x, assets/icons/restore-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="close-button">
            <img class="icon" srcset="assets/icons/close-w-10.png 1x, assets/icons/close-w-12.png 1.25x, assets/icons/close-w-15.png 1.5x, assets/icons/close-w-15.png 1.75x, assets/icons/close-w-20.png 2x, assets/icons/close-w-20.png 2.25x, assets/icons/close-w-24.png 2.5x, assets/icons/close-w-30.png 3x, assets/icons/close-w-30.png 3.5x" draggable="false" />
          </div>

        </div>
      </div>
    </header>

    <div class="setup" id="setupWin" style="display: none;">
      <h1>Welcome to Socially!</h1>
      <p>Thank you for downloading Socially. To get started, please select the socials you use.</p>

      <br>
      <div class="setup-row">
        <div class="col-4" id="fade-ws" style="opacity: 0;">
          <i class="fab fa-whatsapp setup-icon"></i>
          <div class="switch-social" style="margin-top: 10px;">
            <label class="switch">
              <input type="checkbox" id="setup-whatsapp-switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="col-4" id="fade-fb" style="opacity: 0;">
          <i class="fab fa-facebook-messenger setup-icon"></i>
          <div class="switch-social" style="margin-top: 10px;">
            <label class="switch">
              <input type="checkbox" id="setup-facebook-switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="col-4" id="fade-ig" style="opacity: 0;">
          <i class="fab fa-instagram setup-icon"></i>
          <div class="switch-social" style="margin-top: 10px;">
            <label class="switch">
              <input type="checkbox" id="setup-instagram-switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="col-4" id="fade-tw" style="opacity: 0;">
          <i class="fab fa-twitter setup-icon"></i>
          <div class="switch-social" style="margin-top: 10px;">
            <label class="switch">
              <input type="checkbox" id="setup-twitter-switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <div class="col-4" id="fade-te" style="opacity: 0;">
          <i class="fab fa-telegram setup-icon"></i>
          <div class="switch-social" style="margin-top: 10px;">
            <label class="switch">
              <input type="checkbox" id="setup-telegram-switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </div>

      <div class="social-confirm-btn">
        <button class="btn fade-in" id="setup-confirm">Confirm</button>
      </div>
    </div>

    <div class="loading" id="loading" style="display: none;">
      <div id="loader" class="loader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>
    </div>

    <div class="sidebar" id="sidebar" style="display: none;">
      <a id="whatsappBtn" class="sidebar-btn" style="display: none;"><i class="fab fa-whatsapp"></i></a>
      <a id="messengerBtn" class="sidebar-btn" style="display: none;"><i class="fab fa-facebook-messenger"></i></a>
      <a id="instagramBtn" class="sidebar-btn" style="display: none;"><i class="fab fa-instagram"></i></a>
      <a id="twitterBtn" class="sidebar-btn" style="display: none;"><i class="fab fa-twitter"></i></a>
      <a id="telegramBtn" class="sidebar-btn" style="display: none;"><i class="fab fa-telegram"></i></a>
      <a id="settingsBtn" class="sidebar-btn" style="position: fixed; bottom: 5px"><i class="fas fa-cog"></i></a>
    </div>
    <main id="main" style="opacity: 0;">
      
      <div class="content" id="content">

        <div class="fade-in" id="first-time" style="display: none;">
          <h1 class="settings fade-in-setup">Welcome to Socially!</h1>
          <h4 class="first-time-text fade-in-setup"><span style="font-size: 2rem;">←</span>Check out your selected socials here!</h4>
          <h4 class="first-time-text fade-in-setup" style="position: fixed; bottom: 10px;"><span style="font-size: 2rem">←</span>Settings down here!</h4>
        </div>

        <div id="whatsappWin" class="win-pane" style="display: none;">
          <webview id="whatsappWebview" class="webview" src="https://web.whatsapp.com" useragent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"></webview>
          <!--<div id="whatsappLoader" class="winLoader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>-->
        </div>
        <div id="messengerWin" class="win-pane" style="display: none;">
          <webview class="webview" id="messengerWebview" src="https://messenger.com"></webview>
          <!--<div id="messengerLoader" class="winLoader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>-->
        </div>

        <div id="instagramWin" class="win-pane" style="display: none;">        
          <webview class="webview" id="instagramWebview" src="https://www.instagram.com/direct/inbox/"></webview>
          <!--<div id="instagramLoader" class="winLoader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>-->
        </div>
        <div id="twitterWin" class="win-pane" style="display: none;">        
          <webview class="webview" id="twitterWebview" src="https://twitter.com/" useragent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"></webview>
          <!--<div id="twitterLoader" class="winLoader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div> -->
        </div>
        <div id="telegramWin" class="win-pane" style="display: none;">        
          <webview class="webview" id="telegramWebview" src="https://web.telegram.org/#/login" ></webview>
          <!--<div id="telegramLoader" class="winLoader"></div><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>-->
        </div>


        <div class="settings" id="settings" style="display: none;">
          <h1>Settings</h1>
          <div class="setup-row">
            <div class="col-4">
              <i class="fab fa-whatsapp settings-icon"></i>
              <div class="switch-social" style="margin-top: 10px;">
                <label class="switch">
                  <input type="checkbox" id="settings-whatsapp-switch">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div class="col-4">
              <i class="fab fa-facebook-messenger settings-icon"></i>
              <div class="switch-social" style="margin-top: 10px;">
                <label class="switch">
                  <input type="checkbox" id="settings-facebook-switch">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div class="col-4">
              <i class="fab fa-instagram settings-icon"></i>
              <div class="switch-social" style="margin-top: 10px;">
                <label class="switch">
                  <input type="checkbox" id="settings-instagram-switch">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div class="col-4">
              <i class="fab fa-twitter settings-icon"></i>
              <div class="switch-social" style="margin-top: 10px;">
                <label class="switch">
                  <input type="checkbox" id="settings-twitter-switch">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
            <div class="col-4">
              <i class="fab fa-telegram settings-icon"></i>
              <div class="switch-social" style="margin-top: 10px;">
                <label class="switch">
                  <input type="checkbox" id="settings-telegram-switch">
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
          </div>

          <br />
          <br />

          <button class="btn" id="clear-appdata">Clear App Data</button>

          <span class="settings-watermark"><span class="watermark-link" onclick="require('electron').shell.openExternal('https://getsocially.app');" style="cursor: pointer">Socially</span> V0.5 - Handcrafted by <a class="watermark-link" onclick="require('electron').shell.openExternal('https://jackhumphries.co.uk');" style="cursor: pointer">Jack Humphries</a></span>
        </div>

        <div id="loader" class="loader" style="display: none;"><span>Welcome back!</span><div class="lds-ring"><div></div><div></div><div></div><div></div></div></div>

      </div>
    </main>

    <script src="assets/js/notyf.min.js"></script>

    <script>

      // =================================== DEFINITIONS ===============================

      var notyf = new Notyf({ dismissible: true });

      const config = require('electron-json-config');

      var content = document.getElementById("content");
      var mainDiv = document.getElementById("main");
      var sidebar = document.getElementById("sidebar");

      var loader = document.getElementById("loader");

      var whatsappBtn = document.getElementById("whatsappBtn");
      var messengerBtn = document.getElementById("messengerBtn");
      var instagramBtn = document.getElementById("instagramBtn");
      var twitterBtn = document.getElementById("twitterBtn");
      var telegramBtn = document.getElementById("telegramBtn");
      var settingsBtn = document.getElementById("settingsBtn");

      var whatsappWV = document.getElementById("whatsappWin");
      var messengerWV = document.getElementById("messengerWin");
      var instagramWV = document.getElementById("instagramWin");
      var twitterWV = document.getElementById("twitterWin");
      var telegramWV = document.getElementById("telegramWin");

      var whatsappSS = document.getElementById("settings-whatsapp-switch");
      var messengerSS = document.getElementById("settings-facebook-switch");
      var instagramSS = document.getElementById("settings-instagram-switch");
      var twitterSS = document.getElementById("settings-twitter-switch");
      var telegramSS = document.getElementById("settings-telegram-switch");

      var setup = document.getElementById("setupWin");
      var settings = document.getElementById("settings");

      // ============================== UTIL FUNCTIONS =========================

      function resetViews() {
        whatsappBtn.classList.remove("social-active");
        messengerBtn.classList.remove("social-active");
        instagramBtn.classList.remove("social-active");
        twitterBtn.classList.remove("social-active");
        telegramBtn.classList.remove("social-active");
        settingsBtn.classList.remove("social-active");

        whatsappWV.style = "display: none;";
        messengerWV.style = "display: none;";
        instagramWV.style = "display: none;";
        twitterWV.style = "display: none;";
        telegramWV.style = "display: none;";
        settings.style = "display: none;";

        document.getElementById("first-time").style="display: none;"

        loader.style = "display: none;"
      }

      function initApp() {
          if (config.get("app.whatsapp.enabled")) {
            whatsappBtn.style = "";
            whatsappSS.checked = true;
          } 
          if (config.get("app.facebook.enabled")) {
            messengerBtn.style = "";
            messengerSS.checked = true;
          }
          if (config.get("app.instagram.enabled")) {
            instagramBtn.style = "";
            instagramSS.checked = true;
          }
          if (config.get("app.twitter.enabled")) {
            twitterBtn.style = "";
            twitterSS.checked = true;
          }
          if (config.get("app.telegram.enabled")) {
            telegramBtn.style = "";
            telegramSS.checked = true;
          }

          if (config.get("lastApp") == "whatsapp") {
            whatsappBtn.click();
          } else if (config.get("lastApp") == "messenger") {
            messengerBtn.click();
          } else if (config.get("lastApp") == "instagram") {
            instagramBtn.click();
          } else if (config.get("lastApp") == "twitter") {
            twitterBtn.click();
          } else if (config.get("lastApp") == "telegram") {
            telegramBtn.click();
          } else if (config.get("lastApp") == "settings") {
            settingsBtn.click();
          } else {
            document.getElementById("first-time").style= "";
            document.getElementById("first-time").classList.add("fade-in");
          }

          sidebar.style = "";
      }

      function setSwitch(switchS, appbtn, appname) {
        switchS.disabled = true;

        if (switchS.checked) {
          appbtn.style = "";
          appbtn.classList.add("sidebar-icon-zoomin")

          setTimeout(function() {
            appbtn.classList.remove("sidebar-icon-zoomin")
            switchS.disabled = false;
          }, 500);

          notyf.success(`Added ${appname.charAt(0).toUpperCase() + appname.slice(1)}`)

          config.set(`app.${appname}.enabled`, true);
        } else {
          appbtn.classList.add("sidebar-icon-zoomout")

          setTimeout(function() {
            appbtn.style = "display: none;";
            appbtn.classList.remove("sidebar-icon-zoomout")
            switchS.disabled = false;
          }, 500)
          config.set(`app.${appname}.enabled`, false);

          notyf.success(`Removed ${appname.charAt(0).toUpperCase() + appname.slice(1)}`)
        }
      }

      // ================== SIDEBAR EVENT LISTENERS ==================

      whatsappBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "whatsapp");

        whatsappBtn.classList.add("social-active");
        whatsappWV.style = "";
      })

      messengerBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "messenger");

        messengerBtn.classList.add("social-active");
        messengerWV.style = "";

      })

      instagramBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "instagram");

        instagramBtn.classList.add("social-active");
        instagramWV.style = "";
      })

      twitterBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "twitter");

        notyf.error("Error loading Twitter");

        twitterBtn.classList.add("social-active");
        twitterWV.style = "";
      })

      telegramBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "telegram");

        telegramBtn.classList.add("social-active");
        telegramWV.style = "";
      })
      
      // ============================== SETTINGS LISTENERS ====================================

      settingsBtn.addEventListener("click", function () {
        resetViews();

        config.set("lastApp", "settings");

        settingsBtn.classList.add("social-active");
        settings.style = "";
      })

      document.getElementById("clear-appdata").addEventListener('click', function() {
        config.purge();
        require('electron').remote.app.relaunch();
        require('electron').remote.app.exit(0);
      })

      whatsappSS.addEventListener("click", function() {
        setSwitch(whatsappSS, whatsappBtn, "whatsapp");
      });
      
      messengerSS.addEventListener("click", function() {
        setSwitch(messengerSS, messengerBtn, "facebook");
      });

      instagramSS.addEventListener("click", function() {
        setSwitch(instagramSS, instagramBtn, "instagram");
      });

      twitterSS.addEventListener("click", function() {
        setSwitch(twitterSS, twitterBtn, "twitter");
      });

      telegramSS.addEventListener("click", function() {
        setSwitch(telegramSS, telegramBtn, "telegram");
      });

      // ============================= SETUP INSTRUCTIONS ===============================

      document.getElementById("setup-confirm").addEventListener("click", function() {
        if (!document.getElementById("setup-whatsapp-switch").checked && !document.getElementById("setup-facebook-switch").checked && !document.getElementById("setup-instagram-switch").checked && !document.getElementById("setup-twitter-switch").checked && !document.getElementById("setup-telegram-switch").checked) {
            notyf.error("Please select at least one social");
            return;
        }

        setup.classList.add("fade-out");
        setTimeout(function()  {
          setup.style = "display: none;";

          config.set("hasSetup", true);

          if (document.getElementById("setup-whatsapp-switch").checked){
            config.set('app.whatsapp.enabled', true);
            config.set('app.whatsapp.position', 0);
          } else {
            config.set('app.whatsapp.enabled', false);
            config.set('app.whatsapp.position', 0);
          }

          if (document.getElementById("setup-facebook-switch").checked) {
            config.set('app.facebook.enabled', true);
            config.set('app.facebook.position', 1);
          } else {
            config.set('app.facebook.enabled', false);
            config.set('app.facebook.position', 1);
          }

          if (document.getElementById("setup-instagram-switch").checked) {
            config.set('app.instagram.enabled', true);
            config.set('app.instagram.position', 2);       
          } else {
            config.set('app.instagram.enabled', false);
            config.set('app.instagram.position', 2);     
          }

          if (document.getElementById("setup-twitter-switch").checked) {
            config.set('app.twitter.enabled', true);
            config.set('app.twitter.position', 3);     
          } else {
            config.set('app.twitter.enabled', false);
            config.set('app.twitter.position', 3); 
          }

          if (document.getElementById("setup-telegram-switch").checked) {
            config.set('app.telegram.enabled', true);
            config.set('app.telegram.position', 4);     
          } else {
            config.set('app.telegram.enabled', false);
            config.set('app.telegram.position', 4);   
          }

          config.set("lastApp", "none");
          
          initApp();

          sidebar.classList.add("sidebar-fadein");
          setTimeout(function() {
            sidebar.classList.remove("sidebar-fadein");
          }, 1000)


          main.style = "";

          //document.getElementById("first-time").style= "";
          //document.getElementById("first-time").classList.add("fade-in");

          notyf.success("Setup was successful!");

        }, 1000)

      });

      // =============================== WHEN THE DOCUMENT IS LOADED ===================================

      document.addEventListener("DOMContentLoaded", function() {
        console.log("Config file located at: " + config.file());

        if(config.has("hasSetup") == false) {
          setup.style = "";

          //Load animation

          document.getElementById("fade-ws").classList.add("fade-in-setup")
          document.getElementById("fade-ws").style = ""

          setTimeout(function () {
            document.getElementById("fade-fb").classList.add("fade-in-setup")
            document.getElementById("fade-fb").style = "";

            setTimeout(function () {
              document.getElementById("fade-ig").classList.add("fade-in-setup")
              document.getElementById("fade-ig").style = ""

              setTimeout(function () {
                document.getElementById("fade-tw").classList.add("fade-in-setup")
                document.getElementById("fade-tw").style = ""

                setTimeout(function () {
                  document.getElementById("fade-te").classList.add("fade-in-setup")
                  document.getElementById("fade-te").style = ""
            
                }, 250)
              }, 250)
            }, 250)
          }, 250)

        } else {

          initApp();
          //sidebar.classList.add("sidebar-fadein");
          // setTimeout(function() {
          //   sidebar.classList.remove("sidebar-fadein");
          // }, 1000)

          main.style = "";
        }
      })

      
      // You can also require other files to run in this process
      require('./renderer.js')
    </script>
  </body>
</html>
